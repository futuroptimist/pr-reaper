name: Close my open PRs

on:
  workflow_dispatch:
    inputs:
      dry_run:
        description: "dry_run: when true, list what would be closed (no changes)"
        type: boolean
        default: true
      author:
        description: "GitHub username for author: qualifier (blank → uses github.actor)"
        type: string
        default: ""
      org:
        description: "Limit to an org (optional, e.g. democratizedspace)"
        type: string
        default: ""
      title_filter:
        description: "Substring to match in PR title (optional, e.g. Codex)"
        type: string
        default: ""
      delete_branch:
        description: "Delete the PR source branch after closing"
        type: boolean
        default: true
      limit:
        description: "Max PRs to process (1–1000)"
        type: string
        default: "1000"
      comment:
        description: "Closing comment"
        type: string
        default: "Closing as superseded by a newer Codex run."
      exclude_urls:
        description: "PR URLs to skip (space/comma/newline separated, optional)"
        type: string
        default: ""

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  reap:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ secrets.PR_REAPER_TOKEN != '' && secrets.PR_REAPER_TOKEN || secrets.GITHUB_TOKEN }}
    steps:
      - uses: actions/checkout@v4
      - name: Run pr-reaper
        uses: ./
        with:
          dry_run: ${{ github.event.inputs.dry_run }}
          author: ${{ github.event.inputs.author }}
          org: ${{ github.event.inputs.org }}
          title_filter: ${{ github.event.inputs.title_filter }}
          delete_branch: ${{ github.event.inputs.delete_branch }}
          limit: ${{ github.event.inputs.limit }}
          comment: ${{ github.event.inputs.comment }}
          exclude_urls: ${{ github.event.inputs.exclude_urls }}
